{"pageProps":{"post":{"title":"React SSR하는 세 가지 방법 (1)","date":"2020-01-07T00:00:00.000Z","tags":["react","ssr","nginx","prerender"],"draft":false,"summary":"React SSR을 어떻게 하는 것이 가장 합리적일까. 현재 나의 지식 안에서 가장 합리적이라고 생각하는 총 3가지 중 첫 번째에 대한 내용을 정리했다.","body":{"raw":"\n## Next.js를 사용해서 SSR을 하면서 부딪힌 문제 상황\n\n&nbsp; 최근에 회사에서 웹 개편을 시작하면서 큼지막한 기술의 틀은 다음과 같이 정했었다. UI Framework로는 React, Styling을 위해서는 Styled-Component,\nSSR(Server-side rendering)을 하기 위하여 Next.js까지. 다른 많은 라이브러리들도 사용했지만 주요 뼈대는 위와 같이 결정했고, 세팅부터\n페이지 작업까지 열심히 달렸고 하나의 페이지를 위의 기술들을 사용하여 유저들에게 배포했다. 초반에는 큰 이슈 없이 정착하여 다른 페이지들까지 빠르게 이 프로젝트로 옮겨와야지라고 생각하며\n열정을 불태우던 그 즈음. 몇몇 가지 문제들이 내부적으로 인식되었다. 그 당시에도 정확하게 글로 어떤 문제점이 있다라고 문서화를 하진 못했지만, 지금에서라도 정리해보면 다음과 같았다.\n\n- 해외에서 요청을 한다든지 혹은 특정 시간에 `next.js의 응답이 느려지는 순간`이 있다.\n- 그로 인하여, 이벤트나 특정 이유 때문에 traffic이 급작스럽게 몰렸을 경우 `next.js가 잘 견뎌 내지 못할 것이라는 걱정들이 많았고 실제로 굉장히 연약`했다.\n- 하지만, 내부 인력들 중에서는 `node.js 서버에 대한 인프라 관리에 대한 경험치를 일정 수준 가지고 있는 사람이 없었다.`\n- 그러므로, `프론트엔드 관련해서는 infra 관리를 최소화`하고 싶다.\n\n## 새로운 SSR방식 시도\n\n&nbsp; 하지만, 커머스를 하고 있는 입장에서 모든 페이지를 SPA로만 구현하고 그것에만 의존하자라는 결정을 할 순 없었다. 왜냐하면, 요즘은 사실 그렇게 크게 신경쓰지 않아도\n검색엔진들이 잘 해주고 있지만 SEO를 최대한 보장받고 싶었다. 두 번째로는 마케팅이나 외부 플랫폼에 공유했을 때에 SPA처럼 무조건 하나의 메타 정보만을 보여 주어서는\n안 되었다. node 서버나 infra에 대해서 어느 정도 노하우도 조금 생기고 익숙해져 갈 무렵, 리서치와 회의 끝에 이 글에서 설명할 첫 번째 방법으로의 변화를 시도해보기로 결정했다.\n두 번째나 세 번째는 아직 회사에서도 개인적으로 시도해보진 않았지만 첫 번째 방법에 대한 복습을 이 글과 함께 시작 해보고 두 번째, 세 번째 방법도 나름 직접 구현해보고 마지막에 어떤 것이 스스로 생각했을 때에\n현재로서 가장 합리적인 방법인가에 대한 답을 내려보고자 한다. 현재 나의 지식 안에서 가장 합리적일 거라고 생각하는 3가지는 다음과 같다.\n\n> 1. `nginx + react + express (with puppeteer)` - [참고 repository](https://github.com/seonghyeonkimm/nginx-react-prerender) <br />\n> 2. next.js의 serverless - [블로그 링크](https://seonghyeonkimm.github.io/second-react-ssr/) <br />\n> 3. (coming soon) cloudFront + lambda@edge <br />\n\n&nbsp; 즉, 첫 번째 방식은 nginx가 요청을 받고 userAgent를 통해서 request가 bot에 의한 것인지 아닌 지에 따라서 다른 response를 하는 방식이다.\nbot의 요청이라면 puppeteer가 브라우저를 띄워서 실제 html이 다 완성되었을 시기의 html을 캐시하고 보내도록 만들어 둔 express서버로 요청을 전달하고,\n그렇지 않은 경우에는 로컬 머신에 가지고 있는 index.html이든 cloudFront에 올려져 있는 index.html이든 간에 그냥 index.html파일을 내려 준다.\n작업을 하다 보니 경험적으로 느낀 것은 로컬 머신에 있는 index.html을 내려주게 되면 배포 과정에서 실제 server 코드에 대한 배포가 필요 없는 경우에도 배포를 해야 할 수 있기 때문에\n빌드된 결과물을 s3에 올려두고 cloudFront에서 서빙하는 것이 더 빠른 개발과 배포에 좋을 듯 하다. 실제로 위에 언급한 방식을 간단히 그림을 그려 보면 다음과 같다.\n\n![nginx-react-prerender](/static/images/first-react-ssr-diagram.png)\n\n&nbsp; 실제 infra까지 구성한 것은 아니지만, client와 server를 나누어서 직접 로컬에서 간단히 작동하는 수준까지만 작업해보았다.\n연습 삼아 작성해본 코드는 위에 링크 혹은 이 [repository](https://github.com/seonghyeonkimm/nginx-react-prerender)에서 확인할 수 있다. client라는 폴더에는\n그냥 create-react-app과 react-router-dom을 활용한 간단히 테스트를 위해 필요한 react SPA를 구성했다. 그리고 server폴더에는 puppeteer를 사용해서\n직접 해당 path에 대한 html을 chrome에서 동작시켜서 `window.prerenderReady`라는 전역변수가 `true`가 되는 시점에 html content를 bot에게 return하는\nexpress서버 코드와 bot을 판별해 index.html을 그냥 내려줄 지 아니면 express server로 보낼 지 판단하는 간단한 `nginx.conf`가 있다.\n\n## 스스로 생각해보는 장단점 및 결론\n\n&nbsp; next.js를 사용하다가 문제가 있어서 다른 방식을 고안했다는 사실이 next.js가 SSR을 하기에 부적절했다기보다 부끄럽지만 제대로 사용하지 못했던 것이라 생각한다.\n커뮤니티는 점점 더 활발해지고 심지어 next.js는 진짜 빨리 업데이트가 된다. 그래서 개인적으로 좋아하는 편이다. 결국 내가 문제였던 것으로.\n다시 next.js를 사용한다면 cache를 조금 더 세심하게 다룬다면 더 안정성있게 구현할 수 있지 않을까 아쉬움이 남기도 한다.\n무엇이든 유일한 답이란 없고 자신이 풀어야 하는 문제에 가장 합리적인 방법을 선택해야하는 것 뿐이지만. 마지막으로 nginx를 활용한 SSR하는 방법에 대한 장단점을 간단히 정리해보았다.\n\n#### 장점\n\n- SPA를 개발하지만 SSR의 모든 장점을 같이 가져갈 수 있다.\n- 어차피 bot에 대한 요청에만 실행되기 때문에 response time에 대해서 실제 유저가 사용할 때만큼 신경쓰지 않아도 된다. 그래서, 마음껏 SEO를 신경쓰면서 SSR을 할 수 있다. 모든 API가 끝난 결과를 cache하면 된다. (하지만, 요즘은 사실 검색엔진이 crawling을 알아서 잘 해준다.)\n- bot에 대한 요청에만 cache를 하기 때문에 cache의 조건이 사용자의 언어 정도까지만 생각하면 된다. (nextjs의 결과를 cache한다고하면 언어, 사용하는 기기, 로그인 여부 등등이 포함될 수 있는 가능성이 있다.)\n- S3에만 파일을 업로드하면 되기때문에 배포가 빠르다.\n\n#### 단점\n\n- 조금 더 단순하긴 하지만, 역시나 nginx와 express가 떠 있을 instance, 캐시를 위한 redis, 많아질 traffic에 대비할 오토스케일링 등 infra관리가 필요하다.\n\n&nbsp; 마지막으로 회사에서는 이 구성에 대해서 다른 동료 분이 구현해주셔서 직접 구현하지 않았지만 구현하시는 모습을 보면서 공부하는 마음으로\n직접 구현을 해봐야 겠다는 마음을 들게 만들어 주시고 항상 좋은 조언과 에너지를 나눠 주시는 동료 분에게 감사한 마음을 전한다.\n\n## 참고한 글\n\n- https://developers.google.com/web/tools/puppeteer/articles/ssr\n- https://github.com/prerender/prerender\n","code":"var Component=(()=>{var h=Object.create;var c=Object.defineProperty;var a=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,x=Object.prototype.hasOwnProperty;var s=n=>c(n,\"__esModule\",{value:!0});var u=(n,i)=>()=>(i||n((i={exports:{}}).exports,i),i.exports),g=(n,i)=>{s(n);for(var t in i)c(n,t,{get:i[t],enumerable:!0})},f=(n,i,t)=>{if(i&&typeof i==\"object\"||typeof i==\"function\")for(let r of p(i))!x.call(n,r)&&r!==\"default\"&&c(n,r,{get:()=>i[r],enumerable:!(t=a(i,r))||t.enumerable});return n},b=n=>f(s(c(n!=null?h(m(n)):{},\"default\",n&&n.__esModule&&\"default\"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var o=u((w,l)=>{l.exports=_jsx_runtime});var R={};g(R,{default:()=>k,frontmatter:()=>S});var e=b(o()),S={title:\"React SSR\\uD558\\uB294 \\uC138 \\uAC00\\uC9C0 \\uBC29\\uBC95 (1)\",date:\"2020-01-07\",tags:[\"react\",\"ssr\",\"nginx\",\"prerender\"],draft:!1,summary:\"React SSR\\uC744 \\uC5B4\\uB5BB\\uAC8C \\uD558\\uB294 \\uAC83\\uC774 \\uAC00\\uC7A5 \\uD569\\uB9AC\\uC801\\uC77C\\uAE4C. \\uD604\\uC7AC \\uB098\\uC758 \\uC9C0\\uC2DD \\uC548\\uC5D0\\uC11C \\uAC00\\uC7A5 \\uD569\\uB9AC\\uC801\\uC774\\uB77C\\uACE0 \\uC0DD\\uAC01\\uD558\\uB294 \\uCD1D 3\\uAC00\\uC9C0 \\uC911 \\uCCAB \\uBC88\\uC9F8\\uC5D0 \\uB300\\uD55C \\uB0B4\\uC6A9\\uC744 \\uC815\\uB9AC\\uD588\\uB2E4.\"};function j(n={}){let{wrapper:i}=n.components||{};return i?(0,e.jsx)(i,Object.assign({},n,{children:(0,e.jsx)(t,{})})):t();function t(){let r=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",ul:\"ul\",li:\"li\",code:\"code\",blockquote:\"blockquote\",ol:\"ol\",div:\"div\",h4:\"h4\"},n.components),{Image:d}=r;return d||y(\"Image\",!0,\"39:1-39:69\"),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(r.h2,{id:\"nextjs\\uB97C-\\uC0AC\\uC6A9\\uD574\\uC11C-ssr\\uC744-\\uD558\\uBA74\\uC11C-\\uBD80\\uB52A\\uD78C-\\uBB38\\uC81C-\\uC0C1\\uD669\",children:[(0,e.jsx)(r.a,{href:\"#nextjs\\uB97C-\\uC0AC\\uC6A9\\uD574\\uC11C-ssr\\uC744-\\uD558\\uBA74\\uC11C-\\uBD80\\uB52A\\uD78C-\\uBB38\\uC81C-\\uC0C1\\uD669\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(r.span,{className:\"icon icon-link\"})}),\"Next.js\\uB97C \\uC0AC\\uC6A9\\uD574\\uC11C SSR\\uC744 \\uD558\\uBA74\\uC11C \\uBD80\\uB52A\\uD78C \\uBB38\\uC81C \\uC0C1\\uD669\"]}),(0,e.jsx)(r.p,{children:\"\\xA0 \\uCD5C\\uADFC\\uC5D0 \\uD68C\\uC0AC\\uC5D0\\uC11C \\uC6F9 \\uAC1C\\uD3B8\\uC744 \\uC2DC\\uC791\\uD558\\uBA74\\uC11C \\uD07C\\uC9C0\\uB9C9\\uD55C \\uAE30\\uC220\\uC758 \\uD2C0\\uC740 \\uB2E4\\uC74C\\uACFC \\uAC19\\uC774 \\uC815\\uD588\\uC5C8\\uB2E4. UI Framework\\uB85C\\uB294 React, Styling\\uC744 \\uC704\\uD574\\uC11C\\uB294 Styled-Component, SSR(Server-side rendering)\\uC744 \\uD558\\uAE30 \\uC704\\uD558\\uC5EC Next.js\\uAE4C\\uC9C0. \\uB2E4\\uB978 \\uB9CE\\uC740 \\uB77C\\uC774\\uBE0C\\uB7EC\\uB9AC\\uB4E4\\uB3C4 \\uC0AC\\uC6A9\\uD588\\uC9C0\\uB9CC \\uC8FC\\uC694 \\uBF08\\uB300\\uB294 \\uC704\\uC640 \\uAC19\\uC774 \\uACB0\\uC815\\uD588\\uACE0, \\uC138\\uD305\\uBD80\\uD130 \\uD398\\uC774\\uC9C0 \\uC791\\uC5C5\\uAE4C\\uC9C0 \\uC5F4\\uC2EC\\uD788 \\uB2EC\\uB838\\uACE0 \\uD558\\uB098\\uC758 \\uD398\\uC774\\uC9C0\\uB97C \\uC704\\uC758 \\uAE30\\uC220\\uB4E4\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC \\uC720\\uC800\\uB4E4\\uC5D0\\uAC8C \\uBC30\\uD3EC\\uD588\\uB2E4. \\uCD08\\uBC18\\uC5D0\\uB294 \\uD070 \\uC774\\uC288 \\uC5C6\\uC774 \\uC815\\uCC29\\uD558\\uC5EC \\uB2E4\\uB978 \\uD398\\uC774\\uC9C0\\uB4E4\\uAE4C\\uC9C0 \\uBE60\\uB974\\uAC8C \\uC774 \\uD504\\uB85C\\uC81D\\uD2B8\\uB85C \\uC62E\\uACA8\\uC640\\uC57C\\uC9C0\\uB77C\\uACE0 \\uC0DD\\uAC01\\uD558\\uBA70 \\uC5F4\\uC815\\uC744 \\uBD88\\uD0DC\\uC6B0\\uB358 \\uADF8 \\uC988\\uC74C. \\uBA87\\uBA87 \\uAC00\\uC9C0 \\uBB38\\uC81C\\uB4E4\\uC774 \\uB0B4\\uBD80\\uC801\\uC73C\\uB85C \\uC778\\uC2DD\\uB418\\uC5C8\\uB2E4. \\uADF8 \\uB2F9\\uC2DC\\uC5D0\\uB3C4 \\uC815\\uD655\\uD558\\uAC8C \\uAE00\\uB85C \\uC5B4\\uB5A4 \\uBB38\\uC81C\\uC810\\uC774 \\uC788\\uB2E4\\uB77C\\uACE0 \\uBB38\\uC11C\\uD654\\uB97C \\uD558\\uC9C4 \\uBABB\\uD588\\uC9C0\\uB9CC, \\uC9C0\\uAE08\\uC5D0\\uC11C\\uB77C\\uB3C4 \\uC815\\uB9AC\\uD574\\uBCF4\\uBA74 \\uB2E4\\uC74C\\uACFC \\uAC19\\uC558\\uB2E4.\"}),(0,e.jsxs)(r.ul,{children:[(0,e.jsxs)(r.li,{children:[\"\\uD574\\uC678\\uC5D0\\uC11C \\uC694\\uCCAD\\uC744 \\uD55C\\uB2E4\\uB4E0\\uC9C0 \\uD639\\uC740 \\uD2B9\\uC815 \\uC2DC\\uAC04\\uC5D0 \",(0,e.jsx)(r.code,{children:\"next.js\\uC758 \\uC751\\uB2F5\\uC774 \\uB290\\uB824\\uC9C0\\uB294 \\uC21C\\uAC04\"}),\"\\uC774 \\uC788\\uB2E4.\"]}),(0,e.jsxs)(r.li,{children:[\"\\uADF8\\uB85C \\uC778\\uD558\\uC5EC, \\uC774\\uBCA4\\uD2B8\\uB098 \\uD2B9\\uC815 \\uC774\\uC720 \\uB54C\\uBB38\\uC5D0 traffic\\uC774 \\uAE09\\uC791\\uC2A4\\uB7FD\\uAC8C \\uBAB0\\uB838\\uC744 \\uACBD\\uC6B0 \",(0,e.jsx)(r.code,{children:\"next.js\\uAC00 \\uC798 \\uACAC\\uB38C \\uB0B4\\uC9C0 \\uBABB\\uD560 \\uAC83\\uC774\\uB77C\\uB294 \\uAC71\\uC815\\uB4E4\\uC774 \\uB9CE\\uC558\\uACE0 \\uC2E4\\uC81C\\uB85C \\uAD49\\uC7A5\\uD788 \\uC5F0\\uC57D\"}),\"\\uD588\\uB2E4.\"]}),(0,e.jsxs)(r.li,{children:[\"\\uD558\\uC9C0\\uB9CC, \\uB0B4\\uBD80 \\uC778\\uB825\\uB4E4 \\uC911\\uC5D0\\uC11C\\uB294 \",(0,e.jsx)(r.code,{children:\"node.js \\uC11C\\uBC84\\uC5D0 \\uB300\\uD55C \\uC778\\uD504\\uB77C \\uAD00\\uB9AC\\uC5D0 \\uB300\\uD55C \\uACBD\\uD5D8\\uCE58\\uB97C \\uC77C\\uC815 \\uC218\\uC900 \\uAC00\\uC9C0\\uACE0 \\uC788\\uB294 \\uC0AC\\uB78C\\uC774 \\uC5C6\\uC5C8\\uB2E4.\"})]}),(0,e.jsxs)(r.li,{children:[\"\\uADF8\\uB7EC\\uBBC0\\uB85C, \",(0,e.jsx)(r.code,{children:\"\\uD504\\uB860\\uD2B8\\uC5D4\\uB4DC \\uAD00\\uB828\\uD574\\uC11C\\uB294 infra \\uAD00\\uB9AC\\uB97C \\uCD5C\\uC18C\\uD654\"}),\"\\uD558\\uACE0 \\uC2F6\\uB2E4.\"]})]}),(0,e.jsxs)(r.h2,{id:\"\\uC0C8\\uB85C\\uC6B4-ssr\\uBC29\\uC2DD-\\uC2DC\\uB3C4\",children:[(0,e.jsx)(r.a,{href:\"#\\uC0C8\\uB85C\\uC6B4-ssr\\uBC29\\uC2DD-\\uC2DC\\uB3C4\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(r.span,{className:\"icon icon-link\"})}),\"\\uC0C8\\uB85C\\uC6B4 SSR\\uBC29\\uC2DD \\uC2DC\\uB3C4\"]}),(0,e.jsx)(r.p,{children:\"\\xA0 \\uD558\\uC9C0\\uB9CC, \\uCEE4\\uBA38\\uC2A4\\uB97C \\uD558\\uACE0 \\uC788\\uB294 \\uC785\\uC7A5\\uC5D0\\uC11C \\uBAA8\\uB4E0 \\uD398\\uC774\\uC9C0\\uB97C SPA\\uB85C\\uB9CC \\uAD6C\\uD604\\uD558\\uACE0 \\uADF8\\uAC83\\uC5D0\\uB9CC \\uC758\\uC874\\uD558\\uC790\\uB77C\\uB294 \\uACB0\\uC815\\uC744 \\uD560 \\uC21C \\uC5C6\\uC5C8\\uB2E4. \\uC65C\\uB0D0\\uD558\\uBA74, \\uC694\\uC998\\uC740 \\uC0AC\\uC2E4 \\uADF8\\uB807\\uAC8C \\uD06C\\uAC8C \\uC2E0\\uACBD\\uC4F0\\uC9C0 \\uC54A\\uC544\\uB3C4 \\uAC80\\uC0C9\\uC5D4\\uC9C4\\uB4E4\\uC774 \\uC798 \\uD574\\uC8FC\\uACE0 \\uC788\\uC9C0\\uB9CC SEO\\uB97C \\uCD5C\\uB300\\uD55C \\uBCF4\\uC7A5\\uBC1B\\uACE0 \\uC2F6\\uC5C8\\uB2E4. \\uB450 \\uBC88\\uC9F8\\uB85C\\uB294 \\uB9C8\\uCF00\\uD305\\uC774\\uB098 \\uC678\\uBD80 \\uD50C\\uB7AB\\uD3FC\\uC5D0 \\uACF5\\uC720\\uD588\\uC744 \\uB54C\\uC5D0 SPA\\uCC98\\uB7FC \\uBB34\\uC870\\uAC74 \\uD558\\uB098\\uC758 \\uBA54\\uD0C0 \\uC815\\uBCF4\\uB9CC\\uC744 \\uBCF4\\uC5EC \\uC8FC\\uC5B4\\uC11C\\uB294 \\uC548 \\uB418\\uC5C8\\uB2E4. node \\uC11C\\uBC84\\uB098 infra\\uC5D0 \\uB300\\uD574\\uC11C \\uC5B4\\uB290 \\uC815\\uB3C4 \\uB178\\uD558\\uC6B0\\uB3C4 \\uC870\\uAE08 \\uC0DD\\uAE30\\uACE0 \\uC775\\uC219\\uD574\\uC838 \\uAC08 \\uBB34\\uB835, \\uB9AC\\uC11C\\uCE58\\uC640 \\uD68C\\uC758 \\uB05D\\uC5D0 \\uC774 \\uAE00\\uC5D0\\uC11C \\uC124\\uBA85\\uD560 \\uCCAB \\uBC88\\uC9F8 \\uBC29\\uBC95\\uC73C\\uB85C\\uC758 \\uBCC0\\uD654\\uB97C \\uC2DC\\uB3C4\\uD574\\uBCF4\\uAE30\\uB85C \\uACB0\\uC815\\uD588\\uB2E4. \\uB450 \\uBC88\\uC9F8\\uB098 \\uC138 \\uBC88\\uC9F8\\uB294 \\uC544\\uC9C1 \\uD68C\\uC0AC\\uC5D0\\uC11C\\uB3C4 \\uAC1C\\uC778\\uC801\\uC73C\\uB85C \\uC2DC\\uB3C4\\uD574\\uBCF4\\uC9C4 \\uC54A\\uC558\\uC9C0\\uB9CC \\uCCAB \\uBC88\\uC9F8 \\uBC29\\uBC95\\uC5D0 \\uB300\\uD55C \\uBCF5\\uC2B5\\uC744 \\uC774 \\uAE00\\uACFC \\uD568\\uAED8 \\uC2DC\\uC791 \\uD574\\uBCF4\\uACE0 \\uB450 \\uBC88\\uC9F8, \\uC138 \\uBC88\\uC9F8 \\uBC29\\uBC95\\uB3C4 \\uB098\\uB984 \\uC9C1\\uC811 \\uAD6C\\uD604\\uD574\\uBCF4\\uACE0 \\uB9C8\\uC9C0\\uB9C9\\uC5D0 \\uC5B4\\uB5A4 \\uAC83\\uC774 \\uC2A4\\uC2A4\\uB85C \\uC0DD\\uAC01\\uD588\\uC744 \\uB54C\\uC5D0 \\uD604\\uC7AC\\uB85C\\uC11C \\uAC00\\uC7A5 \\uD569\\uB9AC\\uC801\\uC778 \\uBC29\\uBC95\\uC778\\uAC00\\uC5D0 \\uB300\\uD55C \\uB2F5\\uC744 \\uB0B4\\uB824\\uBCF4\\uACE0\\uC790 \\uD55C\\uB2E4. \\uD604\\uC7AC \\uB098\\uC758 \\uC9C0\\uC2DD \\uC548\\uC5D0\\uC11C \\uAC00\\uC7A5 \\uD569\\uB9AC\\uC801\\uC77C \\uAC70\\uB77C\\uACE0 \\uC0DD\\uAC01\\uD558\\uB294 3\\uAC00\\uC9C0\\uB294 \\uB2E4\\uC74C\\uACFC \\uAC19\\uB2E4.\"}),(0,e.jsx)(r.blockquote,{children:(0,e.jsxs)(r.ol,{children:[(0,e.jsxs)(r.li,{children:[(0,e.jsx)(r.code,{children:\"nginx + react + express (with puppeteer)\"}),\" - \",(0,e.jsx)(r.a,{href:\"https://github.com/seonghyeonkimm/nginx-react-prerender\",children:\"\\uCC38\\uACE0 repository\"}),\" \",(0,e.jsx)(\"br\",{})]}),(0,e.jsxs)(r.li,{children:[\"next.js\\uC758 serverless - \",(0,e.jsx)(r.a,{href:\"https://seonghyeonkimm.github.io/second-react-ssr/\",children:\"\\uBE14\\uB85C\\uADF8 \\uB9C1\\uD06C\"}),\" \",(0,e.jsx)(\"br\",{})]}),(0,e.jsxs)(r.li,{children:[\"(coming soon) cloudFront + lambda@edge \",(0,e.jsx)(\"br\",{})]})]})}),(0,e.jsx)(r.p,{children:\"\\xA0 \\uC989, \\uCCAB \\uBC88\\uC9F8 \\uBC29\\uC2DD\\uC740 nginx\\uAC00 \\uC694\\uCCAD\\uC744 \\uBC1B\\uACE0 userAgent\\uB97C \\uD1B5\\uD574\\uC11C request\\uAC00 bot\\uC5D0 \\uC758\\uD55C \\uAC83\\uC778\\uC9C0 \\uC544\\uB2CC \\uC9C0\\uC5D0 \\uB530\\uB77C\\uC11C \\uB2E4\\uB978 response\\uB97C \\uD558\\uB294 \\uBC29\\uC2DD\\uC774\\uB2E4. bot\\uC758 \\uC694\\uCCAD\\uC774\\uB77C\\uBA74 puppeteer\\uAC00 \\uBE0C\\uB77C\\uC6B0\\uC800\\uB97C \\uB744\\uC6CC\\uC11C \\uC2E4\\uC81C html\\uC774 \\uB2E4 \\uC644\\uC131\\uB418\\uC5C8\\uC744 \\uC2DC\\uAE30\\uC758 html\\uC744 \\uCE90\\uC2DC\\uD558\\uACE0 \\uBCF4\\uB0B4\\uB3C4\\uB85D \\uB9CC\\uB4E4\\uC5B4 \\uB454 express\\uC11C\\uBC84\\uB85C \\uC694\\uCCAD\\uC744 \\uC804\\uB2EC\\uD558\\uACE0, \\uADF8\\uB807\\uC9C0 \\uC54A\\uC740 \\uACBD\\uC6B0\\uC5D0\\uB294 \\uB85C\\uCEEC \\uBA38\\uC2E0\\uC5D0 \\uAC00\\uC9C0\\uACE0 \\uC788\\uB294 index.html\\uC774\\uB4E0 cloudFront\\uC5D0 \\uC62C\\uB824\\uC838 \\uC788\\uB294 index.html\\uC774\\uB4E0 \\uAC04\\uC5D0 \\uADF8\\uB0E5 index.html\\uD30C\\uC77C\\uC744 \\uB0B4\\uB824 \\uC900\\uB2E4. \\uC791\\uC5C5\\uC744 \\uD558\\uB2E4 \\uBCF4\\uB2C8 \\uACBD\\uD5D8\\uC801\\uC73C\\uB85C \\uB290\\uB080 \\uAC83\\uC740 \\uB85C\\uCEEC \\uBA38\\uC2E0\\uC5D0 \\uC788\\uB294 index.html\\uC744 \\uB0B4\\uB824\\uC8FC\\uAC8C \\uB418\\uBA74 \\uBC30\\uD3EC \\uACFC\\uC815\\uC5D0\\uC11C \\uC2E4\\uC81C server \\uCF54\\uB4DC\\uC5D0 \\uB300\\uD55C \\uBC30\\uD3EC\\uAC00 \\uD544\\uC694 \\uC5C6\\uB294 \\uACBD\\uC6B0\\uC5D0\\uB3C4 \\uBC30\\uD3EC\\uB97C \\uD574\\uC57C \\uD560 \\uC218 \\uC788\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uBE4C\\uB4DC\\uB41C \\uACB0\\uACFC\\uBB3C\\uC744 s3\\uC5D0 \\uC62C\\uB824\\uB450\\uACE0 cloudFront\\uC5D0\\uC11C \\uC11C\\uBE59\\uD558\\uB294 \\uAC83\\uC774 \\uB354 \\uBE60\\uB978 \\uAC1C\\uBC1C\\uACFC \\uBC30\\uD3EC\\uC5D0 \\uC88B\\uC744 \\uB4EF \\uD558\\uB2E4. \\uC2E4\\uC81C\\uB85C \\uC704\\uC5D0 \\uC5B8\\uAE09\\uD55C \\uBC29\\uC2DD\\uC744 \\uAC04\\uB2E8\\uD788 \\uADF8\\uB9BC\\uC744 \\uADF8\\uB824 \\uBCF4\\uBA74 \\uB2E4\\uC74C\\uACFC \\uAC19\\uB2E4.\"}),(0,e.jsx)(r.div,{children:(0,e.jsx)(d,{alt:\"nginx-react-prerender\",src:\"/static/images/first-react-ssr-diagram.png\",width:\"1157\",height:\"483\"})}),(0,e.jsxs)(r.p,{children:[\"\\xA0 \\uC2E4\\uC81C infra\\uAE4C\\uC9C0 \\uAD6C\\uC131\\uD55C \\uAC83\\uC740 \\uC544\\uB2C8\\uC9C0\\uB9CC, client\\uC640 server\\uB97C \\uB098\\uB204\\uC5B4\\uC11C \\uC9C1\\uC811 \\uB85C\\uCEEC\\uC5D0\\uC11C \\uAC04\\uB2E8\\uD788 \\uC791\\uB3D9\\uD558\\uB294 \\uC218\\uC900\\uAE4C\\uC9C0\\uB9CC \\uC791\\uC5C5\\uD574\\uBCF4\\uC558\\uB2E4. \\uC5F0\\uC2B5 \\uC0BC\\uC544 \\uC791\\uC131\\uD574\\uBCF8 \\uCF54\\uB4DC\\uB294 \\uC704\\uC5D0 \\uB9C1\\uD06C \\uD639\\uC740 \\uC774 \",(0,e.jsx)(r.a,{href:\"https://github.com/seonghyeonkimm/nginx-react-prerender\",children:\"repository\"}),\"\\uC5D0\\uC11C \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4. client\\uB77C\\uB294 \\uD3F4\\uB354\\uC5D0\\uB294 \\uADF8\\uB0E5 create-react-app\\uACFC react-router-dom\\uC744 \\uD65C\\uC6A9\\uD55C \\uAC04\\uB2E8\\uD788 \\uD14C\\uC2A4\\uD2B8\\uB97C \\uC704\\uD574 \\uD544\\uC694\\uD55C react SPA\\uB97C \\uAD6C\\uC131\\uD588\\uB2E4. \\uADF8\\uB9AC\\uACE0 server\\uD3F4\\uB354\\uC5D0\\uB294 puppeteer\\uB97C \\uC0AC\\uC6A9\\uD574\\uC11C \\uC9C1\\uC811 \\uD574\\uB2F9 path\\uC5D0 \\uB300\\uD55C html\\uC744 chrome\\uC5D0\\uC11C \\uB3D9\\uC791\\uC2DC\\uCF1C\\uC11C \",(0,e.jsx)(r.code,{children:\"window.prerenderReady\"}),\"\\uB77C\\uB294 \\uC804\\uC5ED\\uBCC0\\uC218\\uAC00 \",(0,e.jsx)(r.code,{children:\"true\"}),\"\\uAC00 \\uB418\\uB294 \\uC2DC\\uC810\\uC5D0 html content\\uB97C bot\\uC5D0\\uAC8C return\\uD558\\uB294 express\\uC11C\\uBC84 \\uCF54\\uB4DC\\uC640 bot\\uC744 \\uD310\\uBCC4\\uD574 index.html\\uC744 \\uADF8\\uB0E5 \\uB0B4\\uB824\\uC904 \\uC9C0 \\uC544\\uB2C8\\uBA74 express server\\uB85C \\uBCF4\\uB0BC \\uC9C0 \\uD310\\uB2E8\\uD558\\uB294 \\uAC04\\uB2E8\\uD55C \",(0,e.jsx)(r.code,{children:\"nginx.conf\"}),\"\\uAC00 \\uC788\\uB2E4.\"]}),(0,e.jsxs)(r.h2,{id:\"\\uC2A4\\uC2A4\\uB85C-\\uC0DD\\uAC01\\uD574\\uBCF4\\uB294-\\uC7A5\\uB2E8\\uC810-\\uBC0F-\\uACB0\\uB860\",children:[(0,e.jsx)(r.a,{href:\"#\\uC2A4\\uC2A4\\uB85C-\\uC0DD\\uAC01\\uD574\\uBCF4\\uB294-\\uC7A5\\uB2E8\\uC810-\\uBC0F-\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(r.span,{className:\"icon icon-link\"})}),\"\\uC2A4\\uC2A4\\uB85C \\uC0DD\\uAC01\\uD574\\uBCF4\\uB294 \\uC7A5\\uB2E8\\uC810 \\uBC0F \\uACB0\\uB860\"]}),(0,e.jsx)(r.p,{children:\"\\xA0 next.js\\uB97C \\uC0AC\\uC6A9\\uD558\\uB2E4\\uAC00 \\uBB38\\uC81C\\uAC00 \\uC788\\uC5B4\\uC11C \\uB2E4\\uB978 \\uBC29\\uC2DD\\uC744 \\uACE0\\uC548\\uD588\\uB2E4\\uB294 \\uC0AC\\uC2E4\\uC774 next.js\\uAC00 SSR\\uC744 \\uD558\\uAE30\\uC5D0 \\uBD80\\uC801\\uC808\\uD588\\uB2E4\\uAE30\\uBCF4\\uB2E4 \\uBD80\\uB044\\uB7FD\\uC9C0\\uB9CC \\uC81C\\uB300\\uB85C \\uC0AC\\uC6A9\\uD558\\uC9C0 \\uBABB\\uD588\\uB358 \\uAC83\\uC774\\uB77C \\uC0DD\\uAC01\\uD55C\\uB2E4. \\uCEE4\\uBBA4\\uB2C8\\uD2F0\\uB294 \\uC810\\uC810 \\uB354 \\uD65C\\uBC1C\\uD574\\uC9C0\\uACE0 \\uC2EC\\uC9C0\\uC5B4 next.js\\uB294 \\uC9C4\\uC9DC \\uBE68\\uB9AC \\uC5C5\\uB370\\uC774\\uD2B8\\uAC00 \\uB41C\\uB2E4. \\uADF8\\uB798\\uC11C \\uAC1C\\uC778\\uC801\\uC73C\\uB85C \\uC88B\\uC544\\uD558\\uB294 \\uD3B8\\uC774\\uB2E4. \\uACB0\\uAD6D \\uB0B4\\uAC00 \\uBB38\\uC81C\\uC600\\uB358 \\uAC83\\uC73C\\uB85C. \\uB2E4\\uC2DC next.js\\uB97C \\uC0AC\\uC6A9\\uD55C\\uB2E4\\uBA74 cache\\uB97C \\uC870\\uAE08 \\uB354 \\uC138\\uC2EC\\uD558\\uAC8C \\uB2E4\\uB8EC\\uB2E4\\uBA74 \\uB354 \\uC548\\uC815\\uC131\\uC788\\uAC8C \\uAD6C\\uD604\\uD560 \\uC218 \\uC788\\uC9C0 \\uC54A\\uC744\\uAE4C \\uC544\\uC26C\\uC6C0\\uC774 \\uB0A8\\uAE30\\uB3C4 \\uD55C\\uB2E4. \\uBB34\\uC5C7\\uC774\\uB4E0 \\uC720\\uC77C\\uD55C \\uB2F5\\uC774\\uB780 \\uC5C6\\uACE0 \\uC790\\uC2E0\\uC774 \\uD480\\uC5B4\\uC57C \\uD558\\uB294 \\uBB38\\uC81C\\uC5D0 \\uAC00\\uC7A5 \\uD569\\uB9AC\\uC801\\uC778 \\uBC29\\uBC95\\uC744 \\uC120\\uD0DD\\uD574\\uC57C\\uD558\\uB294 \\uAC83 \\uBFD0\\uC774\\uC9C0\\uB9CC. \\uB9C8\\uC9C0\\uB9C9\\uC73C\\uB85C nginx\\uB97C \\uD65C\\uC6A9\\uD55C SSR\\uD558\\uB294 \\uBC29\\uBC95\\uC5D0 \\uB300\\uD55C \\uC7A5\\uB2E8\\uC810\\uC744 \\uAC04\\uB2E8\\uD788 \\uC815\\uB9AC\\uD574\\uBCF4\\uC558\\uB2E4.\"}),(0,e.jsxs)(r.h4,{id:\"\\uC7A5\\uC810\",children:[(0,e.jsx)(r.a,{href:\"#\\uC7A5\\uC810\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(r.span,{className:\"icon icon-link\"})}),\"\\uC7A5\\uC810\"]}),(0,e.jsxs)(r.ul,{children:[(0,e.jsx)(r.li,{children:\"SPA\\uB97C \\uAC1C\\uBC1C\\uD558\\uC9C0\\uB9CC SSR\\uC758 \\uBAA8\\uB4E0 \\uC7A5\\uC810\\uC744 \\uAC19\\uC774 \\uAC00\\uC838\\uAC08 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(r.li,{children:\"\\uC5B4\\uCC28\\uD53C bot\\uC5D0 \\uB300\\uD55C \\uC694\\uCCAD\\uC5D0\\uB9CC \\uC2E4\\uD589\\uB418\\uAE30 \\uB54C\\uBB38\\uC5D0 response time\\uC5D0 \\uB300\\uD574\\uC11C \\uC2E4\\uC81C \\uC720\\uC800\\uAC00 \\uC0AC\\uC6A9\\uD560 \\uB54C\\uB9CC\\uD07C \\uC2E0\\uACBD\\uC4F0\\uC9C0 \\uC54A\\uC544\\uB3C4 \\uB41C\\uB2E4. \\uADF8\\uB798\\uC11C, \\uB9C8\\uC74C\\uAECF SEO\\uB97C \\uC2E0\\uACBD\\uC4F0\\uBA74\\uC11C SSR\\uC744 \\uD560 \\uC218 \\uC788\\uB2E4. \\uBAA8\\uB4E0 API\\uAC00 \\uB05D\\uB09C \\uACB0\\uACFC\\uB97C cache\\uD558\\uBA74 \\uB41C\\uB2E4. (\\uD558\\uC9C0\\uB9CC, \\uC694\\uC998\\uC740 \\uC0AC\\uC2E4 \\uAC80\\uC0C9\\uC5D4\\uC9C4\\uC774 crawling\\uC744 \\uC54C\\uC544\\uC11C \\uC798 \\uD574\\uC900\\uB2E4.)\"}),(0,e.jsx)(r.li,{children:\"bot\\uC5D0 \\uB300\\uD55C \\uC694\\uCCAD\\uC5D0\\uB9CC cache\\uB97C \\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0 cache\\uC758 \\uC870\\uAC74\\uC774 \\uC0AC\\uC6A9\\uC790\\uC758 \\uC5B8\\uC5B4 \\uC815\\uB3C4\\uAE4C\\uC9C0\\uB9CC \\uC0DD\\uAC01\\uD558\\uBA74 \\uB41C\\uB2E4. (nextjs\\uC758 \\uACB0\\uACFC\\uB97C cache\\uD55C\\uB2E4\\uACE0\\uD558\\uBA74 \\uC5B8\\uC5B4, \\uC0AC\\uC6A9\\uD558\\uB294 \\uAE30\\uAE30, \\uB85C\\uADF8\\uC778 \\uC5EC\\uBD80 \\uB4F1\\uB4F1\\uC774 \\uD3EC\\uD568\\uB420 \\uC218 \\uC788\\uB294 \\uAC00\\uB2A5\\uC131\\uC774 \\uC788\\uB2E4.)\"}),(0,e.jsx)(r.li,{children:\"S3\\uC5D0\\uB9CC \\uD30C\\uC77C\\uC744 \\uC5C5\\uB85C\\uB4DC\\uD558\\uBA74 \\uB418\\uAE30\\uB54C\\uBB38\\uC5D0 \\uBC30\\uD3EC\\uAC00 \\uBE60\\uB974\\uB2E4.\"})]}),(0,e.jsxs)(r.h4,{id:\"\\uB2E8\\uC810\",children:[(0,e.jsx)(r.a,{href:\"#\\uB2E8\\uC810\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(r.span,{className:\"icon icon-link\"})}),\"\\uB2E8\\uC810\"]}),(0,e.jsx)(r.ul,{children:(0,e.jsx)(r.li,{children:\"\\uC870\\uAE08 \\uB354 \\uB2E8\\uC21C\\uD558\\uAE34 \\uD558\\uC9C0\\uB9CC, \\uC5ED\\uC2DC\\uB098 nginx\\uC640 express\\uAC00 \\uB5A0 \\uC788\\uC744 instance, \\uCE90\\uC2DC\\uB97C \\uC704\\uD55C redis, \\uB9CE\\uC544\\uC9C8 traffic\\uC5D0 \\uB300\\uBE44\\uD560 \\uC624\\uD1A0\\uC2A4\\uCF00\\uC77C\\uB9C1 \\uB4F1 infra\\uAD00\\uB9AC\\uAC00 \\uD544\\uC694\\uD558\\uB2E4.\"})}),(0,e.jsx)(r.p,{children:\"\\xA0 \\uB9C8\\uC9C0\\uB9C9\\uC73C\\uB85C \\uD68C\\uC0AC\\uC5D0\\uC11C\\uB294 \\uC774 \\uAD6C\\uC131\\uC5D0 \\uB300\\uD574\\uC11C \\uB2E4\\uB978 \\uB3D9\\uB8CC \\uBD84\\uC774 \\uAD6C\\uD604\\uD574\\uC8FC\\uC154\\uC11C \\uC9C1\\uC811 \\uAD6C\\uD604\\uD558\\uC9C0 \\uC54A\\uC558\\uC9C0\\uB9CC \\uAD6C\\uD604\\uD558\\uC2DC\\uB294 \\uBAA8\\uC2B5\\uC744 \\uBCF4\\uBA74\\uC11C \\uACF5\\uBD80\\uD558\\uB294 \\uB9C8\\uC74C\\uC73C\\uB85C \\uC9C1\\uC811 \\uAD6C\\uD604\\uC744 \\uD574\\uBD10\\uC57C \\uACA0\\uB2E4\\uB294 \\uB9C8\\uC74C\\uC744 \\uB4E4\\uAC8C \\uB9CC\\uB4E4\\uC5B4 \\uC8FC\\uC2DC\\uACE0 \\uD56D\\uC0C1 \\uC88B\\uC740 \\uC870\\uC5B8\\uACFC \\uC5D0\\uB108\\uC9C0\\uB97C \\uB098\\uB220 \\uC8FC\\uC2DC\\uB294 \\uB3D9\\uB8CC \\uBD84\\uC5D0\\uAC8C \\uAC10\\uC0AC\\uD55C \\uB9C8\\uC74C\\uC744 \\uC804\\uD55C\\uB2E4.\"}),(0,e.jsxs)(r.h2,{id:\"\\uCC38\\uACE0\\uD55C-\\uAE00\",children:[(0,e.jsx)(r.a,{href:\"#\\uCC38\\uACE0\\uD55C-\\uAE00\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(r.span,{className:\"icon icon-link\"})}),\"\\uCC38\\uACE0\\uD55C \\uAE00\"]}),(0,e.jsxs)(r.ul,{children:[(0,e.jsx)(r.li,{children:(0,e.jsx)(r.a,{href:\"https://developers.google.com/web/tools/puppeteer/articles/ssr\",children:\"https://developers.google.com/web/tools/puppeteer/articles/ssr\"})}),(0,e.jsx)(r.li,{children:(0,e.jsx)(r.a,{href:\"https://github.com/prerender/prerender\",children:\"https://github.com/prerender/prerender\"})})]})]})}}var k=j;function y(n,i,t){throw new Error(\"Expected \"+(i?\"component\":\"object\")+\" `\"+n+\"` to be defined: you likely forgot to import, pass, or provide it.\"+(t?\"\\nIt\\u2019s referenced in your code at `\"+t+\"` in `/Users/roger/workspace/seonghyeonkimm.github.io/_mdx_bundler_entry_point-790cad8b-6bcf-485f-9a83-6746f34eb1ef.mdx`\":\"\"))}return R;})();\n;return Component;"},"_id":"blog/first-react-ssr.mdx","_raw":{"sourceFilePath":"blog/first-react-ssr.mdx","sourceFileName":"first-react-ssr.mdx","sourceFileDir":"blog","contentType":"mdx","flattenedPath":"blog/first-react-ssr"},"type":"Blog","readingTime":{"text":"4 min read","minutes":3.64,"time":218400,"words":728},"slug":"first-react-ssr","toc":[{"value":"Next.js를 사용해서 SSR을 하면서 부딪힌 문제 상황","url":"#nextjs를-사용해서-ssr을-하면서-부딪힌-문제-상황","depth":2},{"value":"새로운 SSR방식 시도","url":"#새로운-ssr방식-시도","depth":2},{"value":"스스로 생각해보는 장단점 및 결론","url":"#스스로-생각해보는-장단점-및-결론","depth":2},{"value":"장점","url":"#장점","depth":4},{"value":"단점","url":"#단점","depth":4},{"value":"참고한 글","url":"#참고한-글","depth":2}]},"authorDetails":[{}],"prev":{"title":"내가 꿈꾸는 '파워풀'한 팀의 모습","date":"2019-12-28T00:00:00.000Z","tags":["netflix","culture","team","powerful"],"draft":false,"summary":"넷플릭스의 문화에 대한 책인 '파워풀'을 읽으면서 눈에 들어 왔던 표현을 기반으로 내가 꿈꾸는 '파워풀'한 팀의 모습 몇 가지를 생각 해 보았다.","type":"Blog","readingTime":{"text":"6 min read","minutes":5.305,"time":318300,"words":1061},"slug":"i-am-not-powerfull","toc":[{"value":"TL;DR","url":"#tldr","depth":3},{"value":"솔직해지는 용기를 지닌 사람이 되자","url":"#솔직해지는-용기를-지닌-사람이-되자","depth":2},{"value":"사실과 데이터에 기반한 커뮤니케이션을 하자","url":"#사실과-데이터에-기반한-커뮤니케이션을-하자","depth":2},{"value":"회사에 대한 충분한 정보를 동기화하려는 노력을 하자","url":"#회사에-대한-충분한-정보를-동기화하려는-노력을-하자","depth":2},{"value":"정기적인 소통의 자리를 가지자","url":"#정기적인-소통의-자리를-가지자","depth":2}]},"next":{"title":"React SSR하는 세 가지 방법 (2)","date":"2020-01-14T00:00:00.000Z","tags":["react","ssr","serverless"],"draft":false,"summary":"React SSR하는 두 번째 방법으로 next.js, serverless-next.js를 활용해서 구현을 해보았다.","type":"Blog","readingTime":{"text":"4 min read","minutes":3.535,"time":212100,"words":707},"slug":"second-react-ssr","toc":[{"value":"처음 생각했던 구현 방향","url":"#처음-생각했던-구현-방향","depth":2},{"value":"실습한 결과물 공유 및 느낀 점","url":"#실습한-결과물-공유-및-느낀-점","depth":2},{"value":"스스로 생각해보는 장단점 및 결론","url":"#스스로-생각해보는-장단점-및-결론","depth":2},{"value":"장점","url":"#장점","depth":4},{"value":"단점","url":"#단점","depth":4},{"value":"참고한 글","url":"#참고한-글","depth":2}]}},"__N_SSG":true}